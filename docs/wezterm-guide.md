# WezTerm ガイド

Windows + WSL2環境に最適化した設定です。Leaderキーとキーテーブルを軸に、Vimライクな操作感でターミナルを扱います。

---

## 第1部: クイックスタート

### 重要なキー概念
**Leaderキー（`Ctrl+Q`）**
- 特殊操作の前に押す合図
- 2秒以内に次のキーを押す

### 基本操作早見表
**コピー・ペースト**
| 操作 | キー | 説明 |
|------|------|------|
| コピー | `Ctrl+Shift+C` | クリップボードへ |
| ペースト | `Ctrl+Shift+V` | クリップボードから |
| 右クリック | 右クリック | ペースト |
| ミドルクリック | 中クリック | プライマリ選択ペースト |

**タブ操作**
| 操作 | キー | 説明 |
|------|------|------|
| 新規タブ | `Ctrl+T` | 新しいタブ |
| タブを閉じる | `Ctrl+W` | 確認あり |
| 次/前のタブ | `Ctrl+Tab` / `Ctrl+Shift+Tab` | 相対移動 |
| タブ番号移動 | `Alt+1..9` | `9`は最後 |
| タブ入れ替え | `Ctrl+Q` → `{` / `}` | 左右に移動 |

**ペイン操作**
| 操作 | キー | 説明 |
|------|------|------|
| 垂直分割 | `Ctrl+Q` → `d` | 上下に分割 |
| 水平分割 | `Ctrl+Q` → `r` | 左右に分割 |
| ペイン移動 | `Ctrl+Q` → `h/j/k/l` | 方向移動 |
| ペイン選択 | `Ctrl+Shift+[` | GUIで選択 |
| ペインを閉じる | `Ctrl+Q` → `x` | 確認あり |
| ペイン最大化 | `Ctrl+Q` → `z` | ズーム切替 |

**コピーモード**
| 操作 | キー | 説明 |
|------|------|------|
| 開始 | `Ctrl+Q` → `[` | Copy Mode |
| 選択 | `v` / `V` / `Ctrl+v` | 文字/行/ブロック |
| コピー | `y` | コピーして終了 |
| 退出 | `q` / `Esc` | コピーせず終了 |

### よく使う操作の例
**ターミナルの出力をキーボードだけでコピー**
1. `Ctrl+Q` → `[` でコピーモード
2. `v` で選択開始、`h/j/k/l`で範囲選択
3. `y` でコピー
4. `Ctrl+Shift+V` でペースト

**ワークスペースを切り替える**
1. `Ctrl+Q` → `w`
2. ワークスペースを選択

---

## 第2部: 詳細説明（思想と概念）

### 1. WezTermの思想
WezTermは「ターミナル + タブ + ペイン + ワークスペース」を一体で扱える設計です。ターミナルのセッションを整理し、用途別に切り替えることが主眼です。

### 2. 階層モデル
| 概念 | 役割 | 例 |
|------|------|----|
| ワークスペース | 作業単位 | frontend / backend |
| タブ | セッションのまとまり | プロジェクト単位 |
| ペイン | 分割された端末 | 上下/左右分割 |

### 3. Leaderとキーテーブル
Leaderは`Ctrl+Q`です。そこから一時的に「モード」に入るのがキーテーブルです。

**キーテーブル例**
| モード | キー | 役割 |
|--------|------|------|
| サイズ調整 | `Ctrl+Q` → `s` | `h/j/k/l`でリサイズ |
| ペイン選択 | `Ctrl+Q` → `a` | 方向指定で選択 |

右上のステータスに現在のキーテーブル名が表示されるため、どのモードにいるか把握できます。

### 4. Copy Modeの設計
Copy ModeはVimの移動体系を取り込み、キーボードだけでコピーできるように設計されています。

**主要操作**
| 操作 | キー |
|------|------|
| 移動 | `h/j/k/l`, `w/b/e` |
| 行頭/行末 | `0` / `^` / `$` |
| 画面移動 | `Ctrl+b` / `Ctrl+f` / `Ctrl+u` / `Ctrl+d` |
| 選択 | `v` / `V` / `Ctrl+v` |
| コピー | `y` または `Enter` |

### 5. タブとペイン操作の思想
タブは作業単位、ペインは同時参照用です。タブの並び替えは`Ctrl+Q`→`{`/`}`で行い、ペイン操作はLeader経由に集約しています。

### 6. ワークスペース運用
**切り替え/作成/名前変更**
| 操作 | キー |
|------|------|
| 切り替え | `Ctrl+Q` → `w` |
| 新規作成 | `Ctrl+Q` → `Shift+W` |
| 名前変更 | `Ctrl+Q` → `$` |

ワークスペースは「プロジェクト単位」で切ると管理しやすくなります。

### 7. UIと外観
**この設定の特徴**
- 背景透過: `0.85`
- Windowsのぼかし: `Acrylic`
- タブバーは1タブの時は非表示
- タブの追加/閉じるボタン非表示
- Nerd Fontの記号でタブ形状を装飾

### 8. 入力系の拡張
- `enable_csi_u_key_encoding = true` を有効化
- `Shift+Enter` はCSI u形式で送信（OpenCode用）

### 9. WSL2起動
既定ドメインは`WSL:Ubuntu`です。起動時のディレクトリは`~`に固定しています。

### 9.1 設定ファイルの注意（重要）
- Windows版WezTermの実設定ファイルは`C:\Users\htk\.wezterm.lua`です。
- WSL側の`~/.config/wezterm/wezterm.lua`を編集しても反映されません。
- 設定変更時は`/mnt/c/Users/htk/.wezterm.lua`（Windows側）を編集してください。

### 10. キーバインド（全体像）
**コマンドパレット**
- `Alt+Shift+P`
- `Ctrl+Q` → `p`

**再読み込み**
- `Ctrl+Shift+R`

---

## トラブルシューティング
### キーバインドが効かない
1. `Ctrl+Shift+R`で再読み込み
2. 構文エラー確認
   ```bash
   lua /mnt/c/Users/htk/.wezterm.lua
   ```

### WSL2が起動しない
```lua
config.default_domain = "WSL:Ubuntu"
```
PowerShellで確認:
```powershell
wsl -l -v
```

---

## 参考リンク
- [WezTerm公式ドキュメント](https://wezfurlong.org/wezterm/)
- [Config Options](https://wezfurlong.org/wezterm/config/lua/config/index.html)
- [Lua Reference](https://www.lua.org/docs.html)
- [Nerd Fonts](https://www.nerdfonts.com/)

---

**作成日**: 2026年2月  
**対象環境**: Windows 10/11 + WSL2 + WezTerm
